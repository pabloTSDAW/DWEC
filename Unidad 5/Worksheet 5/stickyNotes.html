<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Sticky Notes</title>
</head>
<style media="screen">

  body {
    background-image: url('images/corcho.jpg');
    display: flex;
    flex-wrap: wrap;
  }

  #boton {
    margin: 15px;
    box-shadow: 3px 3px 3px rgb(6, 6, 6);
    width: 120px;
    height: 30px;
    color: rgb(57, 55, 57);
    font-weight: bold;
  }

  #boton:hover {
    background-color: rgb(42, 43, 42);
    color: rgb(254, 254, 254);
  }

  .nota {
    position: absolute;
    width: 200px;
    height: 200px;
    box-shadow: 5px 5px 2px rgb(32, 31, 31);
    margin: 10px;
  }

  textarea {
    border: none;
    resize: none;
    width: 90%;
    height: 50%;
    margin: 0 2% 0 3%;
    padding: 2%;
  }

  h4 {
    margin-top: 0;
    height: 10%;
    padding: 2%;
  }

  .eliminar {
    float: right;
  }

  p {
    font-size: 14px;
    width: 95%;
    height: 5%;
    padding: 4% 2% 4% 7%;
    align-self: flex-end;
  }

  a {
    display: inline-block;
    float: right;
  }

</style>

<body>

  <div id="tablero">
    <button type="button" id="boton">Nueva Nota</button>
  </div>

  <script type="text/javascript">
    //MODELO----------------------------------------------------------------------

    var notaPinchada = false;
    var posEX = 0;
    var posEY = 0;
    var posX = 0;
    var posY = 0;

    var colores = [['rgb(252, 255, 17)', 'rgb(234, 237, 14)'],
                    ['rgb(23, 203, 202)', 'rgb(47, 153, 222)'],
                    ['rgb(180, 142, 242)', 'rgb(165, 102, 228)'],
                    ['rgb(255, 255, 255)', 'rgb(233, 225, 225)'],
                    ['rgb(170, 231, 82)', 'rgb(155, 210, 76)']];


    class Nota {
      constructor(id) {
        this.id = id;
        this.titulo = '';
        this.texto = '';
      }
    }

    class ListaNotas {
      constructor() {
        this.id = 0;
        this.notas = [];
      }
    }


    //VISTA-----------------------------------------------------------------------

    class NotaView {
      constructor(controlador) {
        this.controlador = controlador;
      }


      nuevaNota(id, titulo = '', texto = '', fecha, color) {
        var self = this;

        this.notaV = document.createElement('div');
        this.notaV.setAttribute('class', 'nota');
        this.notaV.setAttribute('id', `${id}`);
        this.notaV.setAttribute('style','left: 100px; top: 100px;');
        this.notaV.style.backgroundColor = colores[color][0];
        document.getElementById('tablero').appendChild(this.notaV);
        this.notaV.setAttribute('onmousedown', 'controlador.agarrar(this); controlador.cambiarDatos(event)');

        this.tituloV = document.createElement('h4');
        this.notaV.appendChild(this.tituloV);
        this.tituloV.style.backgroundColor = colores[color][1];
        this.tituloV.innerHTML = titulo;

        this.textoV = document.createElement('textarea');
        this.notaV.appendChild(this.textoV);
        this.textoV.style.backgroundColor = colores[color][0];

        this.horaV = document.createElement('p');
        this.notaV.appendChild(this.horaV);
        this.horaV.innerHTML = 'Creada el: ' + fecha;

        this.boton = document.createElement('button');
        this.boton.setAttribute('type', 'button');
        this.boton.setAttribute('class', 'eliminar');
        this.boton.addEventListener('click', function(){
          self.borrarNota(id);
        });
        this.boton.innerHTML = 'X';
        this.tituloV.appendChild(this.boton);
      }

      borrarNota(id){
        document.getElementById('tablero').removeChild(document.getElementById(id));
        this.controlador.lista.notas.splice(this.controlador.lista.notas[id], 1);
      }

    }


    //CONTROLADOR-----------------------------------------------------------------

    class Controlador{
      constructor(){
        var self = this;
        this.lista = new ListaNotas();
        this.nuevaVista = new NotaView(this);
        this.boton = document.getElementById('boton');
        this.boton.addEventListener('click', function(){
          self.insertarPosit();
        });
        this.elemento;
      }

      insertarPosit(){
        var title = prompt('Escribe un tÃ­tulo para la nota');
        var color = prompt('Selecciona un color: 0 (amarillo), 1 (azul), 2 (violeta), 3 (blanco), 4 (verde)')
        this.hora = new Date();
        this.creada = this.hora.getDate() + '/' + this.hora.getMonth() + '/' + this.hora.getFullYear() + ' ' + this.hora.getHours() + ':' + this.hora.getMinutes() + ':' + this.hora.getSeconds();
        this.lista.notas.push(new Nota(this.lista.id));
        if ((color >= 0) && (color <= colores.length)){
          this.nuevaVista.nuevaNota(this.lista.id, title, '', this.creada, color);
        }
        else {this.nuevaVista.nuevaNota(this.lista.id, title, '', this.creada, 0)};
        this.lista.id++;
      }

      agarrar(elemento) {
        notaPinchada = true;
        this.elemento = elemento;
      }

      cambiarDatos(e){
        posEY = e.clientY;
        posEX = e.clientX;
        posY = parseInt(this.elemento.style.top);
        posX = parseInt(this.elemento.style.left);
      }

      mover(e) {
        if (notaPinchada) {
          this.elemento.style.top = (posY + e.clientY - posEY) + 'px';
          this.elemento.style.left = (posX + e.clientX - posEX) + 'px';
          }
      }

    }


    //MAIN------------------------------------------------------------------------

    window.onload = () => {
    controlador = new Controlador();
    }

    window.onmouseup = function(){
      notaPinchada = false;
    }

    document.addEventListener('mousemove', function(e) {
      controlador.mover(event);
    }, false);


  </script>

</body>

</html>
